<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.levware.common.mappers.repo.UserBoardMapper">	
<!-- 저장 목록 VO -->
	<resultMap type="BoardVO" id="BoardListMap">
		<result property="seqNum" column="BOARD_SEQ" />
		<result property="boardTitle" column="BOARD_TITLE" />
		<result property="boardContents" column="BOARD_CONTENTS" />
		<result property="boardWriter" column="BOARD_WRITER" />
		<result property="userId" column="USER_ID" />
		<result property="createDt" column="CREATE_DT" />
		<result property="createTm" column="CREATE_TM" />
		<result property="updateDt" column="UPDATE_DT" />
		<result property="updateTm" column="UPDATE_TM" />
		<result property="boardViews" column="BOARD_VIEWS" />
	</resultMap>
	<select id="boardList" resultMap="BoardListMap">
			SELECT BOARD_SEQ,
				   BOARD_TITLE,
				   BOARD_CONTENTS,
				   BOARD_WRITER,
				   USER_ID,
				   CREATE_DT,
				   CREATE_TM,
				   UPDATE_DT,
				   UPDATE_TM,
				   BOARD_VIEWS 
			FROM TB_USR_BOARD
			order by BOARD_SEQ DESC
	</select>

	<insert id="insertBoard" parameterType="map">
		INSERT INTO TB_USR_BOARD
		(BOARD_SEQ,BOARD_TITLE,BOARD_CONTENTS,BOARD_WRITER,USER_ID,CREATE_DT,CREATE_TM)
		VALUES
		(#{seqNum}, #{boardTitle}, #{boardContents}, #{boardWriter}, #{userId}, #{createDt}, #{createTm})
	</insert>
	
	<select id="boardViewSeq" parameterType="String" resultType="int">
		SELECT 
			NVL(MAX(BOARD_SEQ),0)  AS BOARD_SEQ 
		FROM TB_USR_BOARD 
		WHERE USER_ID=#{userId}
	</select>
	
	<update id="updateBoard" parameterType="map">
		UPDATE 
			TB_USR_BOARD
		SET 
			BOARD_TITLE = #{boardTitle}, 
			BOARD_CONTENTS = #{boardContents}, 
			USER_ID = #{userId},
			UPDATE_DT = #{updateDt},
			UPDATE_TM = #{updateTm}
		WHERE
			BOARD_SEQ = #{seqNum} AND
		 	USER_ID = #{userId}
	</update>
	
	<select id="selectBoard" parameterType="Int" resultMap="BoardListMap">
        SELECT BOARD_SEQ,
				   BOARD_TITLE,
				   BOARD_CONTENTS,
				   BOARD_WRITER,
				   USER_ID,
				   CREATE_DT,
				   CREATE_TM,
				   UPDATE_DT,
				   UPDATE_TM,
				   BOARD_VIEWS 
		FROM TB_USR_BOARD
        WHERE BOARD_SEQ = #{seqNum}
    </select>
    
    <update id="updateViewCnt">
    	UPDATE TB_USR_BOARD SET
		   BOARD_VIEWS = NVL(TO_NUMBER(BOARD_VIEWS),0)+1
		WHERE BOARD_SEQ = #{seqNum}
    </update>
    
    <delete id="deleteBoard" parameterType="Int">
    	DELETE FROM TB_USR_BOARD 
		WHERE 
		BOARD_SEQ = #{seqNum}
    </delete>
    
</mapper>