<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/security
        http://www.springframework.org/schema/security/spring-security.xsd">

<beans:bean id="LoginSuccessHandler" class="com.levware.common.auth.LoginSuccessHandler"></beans:bean>
<beans:bean id="encoder" class="org.springframework.security.crypto.password.StandardPasswordEncoder"/>
<beans:bean id="logoutSuccessHandler" class="com.levware.common.auth.CustomLogoutSuccessHandler"></beans:bean>
<beans:bean id="ajaxSessionTimeoutFilter" class="com.levware.common.auth.AjaxSessionTimeoutFilter">
	<beans:property name="ajaxHeader" value="AJAX"></beans:property>
</beans:bean>
	<http pattern="/js/**" security="none"></http>
	<http pattern="/css/**" security="none"></http>
	<http pattern="/images/**" security="none"></http>
	
	<http auto-config="true" use-expressions="true">
		<csrf disabled="true"/>
		<headers>
	        <frame-options policy="SAMEORIGIN" /><!-- iframe page 허용. -->
	    </headers>
		<intercept-url pattern="/js/**" access="permitAll" />
		<intercept-url pattern="/css/**" access="permitAll" />
		<intercept-url pattern="/images/**" access="permitAll" />
		<intercept-url pattern="/user/**" access="hasRole('ROLE_USER') or hasRole('ROLE_ADMIN') or hasRole('ROLE_SUPER')"/>
		<intercept-url pattern="/ml/**" access="hasRole('ROLE_USER') or hasRole('ROLE_ADMIN') or hasRole('ROLE_SUPER')"/>
		<intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN') or hasRole('ROLE_SUPER')"/>
		<intercept-url pattern="/**" access="permitAll" />
		<custom-filter after="EXCEPTION_TRANSLATION_FILTER" ref="ajaxSessionTimeoutFilter"/>
		<form-login 
			login-page="/logon.do" 
			authentication-success-handler-ref="LoginSuccessHandler"
			authentication-failure-url="/logon.do?fail=true"
			username-parameter="loginid"
			password-parameter="loginpw"
		/>			
		<logout logout-url="/logout" invalidate-session="true" success-handler-ref="logoutSuccessHandler" />
		<access-denied-handler error-page="/logon.do" />
	</http>
	
	<authentication-manager>
		<authentication-provider >
				<password-encoder ref="encoder" />
				<jdbc-user-service data-source-ref="repositoryDataSource"
					users-by-username-query="SELECT A.* FROM
						(select USER_ID AS userName, USER_PASSWORD AS password, enabled FROM TB_OLAP_USR
						union all select MANAGER_ID AS userName, MANAGER_PW AS password, enabled FROM TB_OLAP_MANAGER) A
						WHERE A.userName=? AND enabled=1"
					authorities-by-username-query="SELECT A.* FROM
						(select USER_ID AS userName, USER_ROLE AS authority FROM TB_OLAP_USR WHERE enabled=1
						union all select MANAGER_ID AS userName, USER_ROLE AS authority FROM TB_OLAP_MANAGER WHERE ENABLED=1) A
						WHERE A.userName =?"
				/>
		</authentication-provider>
	</authentication-manager>
</beans:beans>

