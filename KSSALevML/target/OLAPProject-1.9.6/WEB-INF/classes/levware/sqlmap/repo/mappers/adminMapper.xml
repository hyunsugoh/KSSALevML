<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.levware.common.mappers.repo.AdminMapper">


	<!-- Result Map -->
	<resultMap type="AdminObjectListVO" id="AdminObjectListVOMap">
		<result property="table_name" column="TABLE_NAME" />
		<result property="obj_name" column="OBJ_NAME" />
		<result property="obj_desc" column="OBJ_DESC" />
		<result property="activ_yn" column="ACTIV_YN" />
	</resultMap>

	<select id="getAdminObjectList" parameterType="map"
		resultMap="AdminObjectListVOMap">
		select TABLE_NAME,OBJ_NAME,OBJ_DESC,ACTIV_YN
		from TB_OBJECT
		order by OBJ_NAME ASC
		NULLS FIRST
	</select>

	<!-- 코드관리 Result Map 작성자 박수연 -->
	<resultMap type="CodeManagementVO" id="CodeManagementVOMap">
		<result property="qryConCd" column="QRY_CON_CD" />
		<result property="qryConCdNm" column="QRY_CON_CD_NM" />
		<result property="operSym" column="OPER_SYM" />
		<result property="qryExample" column="QRY_EXAMPLE" />
	</resultMap>
	<!-- 코드관리 select 작성자 박수연 -->
	<select id="getCodeManagementList" resultMap="CodeManagementVOMap">
		SELECT QRY_CON_CD,
		QRY_CON_CD_NM, OPER_SYM, CREATE_TM, CREATE_DT,QRY_EXAMPLE
		FROM
		TB_QRY_CON_CD ORDER BY CREATE_DT DESC, CREATE_TM DESC, QRY_CON_CD ASC
	</select>
	<!-- 코드관리 insert 작성자 박수연 -->
	<insert id="insertCodeManagement" parameterType="CodeManagementVO">
		INSERT INTO
		TB_QRY_CON_CD(QRY_CON_CD,QRY_CON_CD_NM,OPER_SYM,QRY_EXAMPLE,CREATE_ID)
		VALUES
		(#{qryConCd},#{qryConCdNm},#{operSym},#{qryExample},#{createId})
	</insert>
	<!-- 코드관리 delete 작성자 박수연 -->
	<delete id="deleteCodeManagement" parameterType="java.util.List">
		DELETE FROM TB_QRY_CON_CD
		WHERE QRY_CON_CD IN
		<foreach collection="list" item="item" index="index" open="("
			close=")" separator=",">
			#{item,jdbcType=VARCHAR}
		</foreach>
	</delete>

	<delete id="setAdminObjectDelete" parameterType="String">
		<![CDATA[
			delete from TB_OBJECT
			where  TABLE_NAME = #{table_name}
		]]>
	</delete>

	<update id="setAdminObjectActive" parameterType="map">

		update TB_OBJECT

		<if test='activ_yn == "N"'>
			set ACTIV_YN = 'Y'
		</if>
		<if test='activ_yn == "Y"'>
			set ACTIV_YN = 'N'
		</if>
		,
		UPDATE_ID = #{ID},

		UPDATE_DT =
		to_char(SYSDATE,'yyyymmdd'),

		UPDATE_TM =
		to_char(SYSDATE,'hh24miss')

		where TABLE_NAME = #{table_name}

	</update>

	<!-- 객체관리 insert 작성자 조형욱 -->
	<insert id="setAdminObjectInsert">
		INSERT INTO
		TB_OBJECT(TABLE_NAME,CREATE_ID,UPDATE_ID,UPDATE_DT,UPDATE_TM)
		VALUES
		(#{object_name},#{ID},#{ID},to_char(SYSDATE,'yyyymmdd'),to_char(SYSDATE,'hh24miss'))
	</insert>

	<!-- repo에서 테이블 리스트 가져오기 작성자 조형욱 -->
	<select id="getAdminObjectTableList" resultType="map">
		select
		table_name from TB_OBJECT

	</select>
	<!-- 객체 관리 업데이트 작성자 조형욱 -->
	<update id="setAdminObjectUpdate" parameterType="map">

		update TB_OBJECT


		set obj_name = #{obj_name},

		obj_desc = #{obj_desc},

		UPDATE_ID = #{ID},

		update_dt =
		to_char(SYSDATE,'yyyymmdd'),

		update_tm =
		to_char(SYSDATE,'hh24miss')

		where table_name =
		#{table_name}

	</update>


	<!-- 객체 정보 관리 리스트 작성자 조형욱 -->
	<select id="getAdminObjectInfoList" parameterType="String"
		resultType="map">
		select
		a.table_name table_name,a.col_name col_name
		,a.objinfo_name
		objinfo_name,a.objinfo_desc
		objinfo_desc,a.pk_gubun
		pk_gubun,a.data_type data_type
		,a.stand_date stand_date
		,a.view_duration_unit VIEW_DURATION_UNIT
		,a.view_duration_num
		VIEW_DURATION_NUM
		,a.seq SEQ
		,a.display_yn DISPLAY_YN
		,a.calc_func_yn CALC_FUNC_YN
		
		from
		TB_OBJINFO A
		WHERE a.table_name =
		#{table_name}
		order by
		TO_NUMBER(SEQ)
	</select>



	<!-- 객체 정보 활성화 채크 작성자 조형욱 -->
	<select id="getAdminObjectActiveCheck1" parameterType="String"
		resultType="map">
		SELECT OBJ_NAME FROM TB_OBJECT
		WHERE table_name =
		#{table_name}
	</select>


	<!-- 객체 정보 활성화 채크 작성자 조형욱 -->
	<select id="getAdminObjectActiveCheck2" parameterType="String"
		resultType="map">
		SELECT TABLE_NAME FROM TB_OBJINFO
		WHERE table_name =
		#{table_name}
	</select>

	<!-- 객체 정보 관리 insert 작성자 조형욱 -->
	<insert id="setAdminObjectInfoInsert" parameterType="map">
		INSERT INTO
		TB_OBJINFO(TABLE_NAME,COL_NAME,OBJINFO_NAME,OBJINFO_DESC,DATA_TYPE,PK_GUBUN,STAND_DATE,CREATE_ID,UPDATE_ID,UPDATE_DT,UPDATE_TM,VIEW_DURATION_UNIT,VIEW_DURATION_NUM,SEQ,DISPLAY_YN,CALC_FUNC_YN)
		VALUES
		(#{TABLE_NAME},#{COLUMN_NAME},#{OBJINFO_NAME},#{OBJINFO_DESC},#{DATA_TYPE},#{PK_GUBUN},#{STAND_DATE},#{ID},#{ID},to_char(SYSDATE,'yyyymmdd'),to_char(SYSDATE,'hh24miss'),#{VIEW_DURATION_UNIT},#{VIEW_DURATION_NUM},#{SEQ},#{DISPLAY_YN},#{CALC_FUNC_YN})
	</insert>


<!-- 객체 정보 관리 업데이트 작성자 조형욱 -->
	<update id="setAdminObjectInfoUpdate" parameterType="map">

		update
		TB_OBJINFO


		set OBJINFO_NAME = #{OBJINFO_NAME},

		OBJINFO_DESC =
		#{OBJINFO_DESC},

		DATA_TYPE = #{DATA_TYPE},
		
		PK_GUBUN = #{PK_GUBUN},

		STAND_DATE = #{STAND_DATE},

		UPDATE_ID = #{ID},

		update_dt =
		to_char(SYSDATE,'yyyymmdd'),

		update_tm =
		to_char(SYSDATE,'hh24miss'),
		
		VIEW_DURATION_UNIT = #{VIEW_DURATION_UNIT}
		
		,VIEW_DURATION_NUM = #{VIEW_DURATION_NUM}
        ,SEQ = #{SEQ}
		
		,DISPLAY_YN = #{DISPLAY_YN}
		
		,CALC_FUNC_YN = #{CALC_FUNC_YN}
		
		

		where TABLE_NAME = #{TABLE_NAME}

		and
		COL_NAME = #{COL_NAME}

	</update>



	<!-- 객체 정보 관리 삭제 작성자 조형욱 -->
	<delete id="setAdminObjectInfoDelete" parameterType="String">

		delete from
		TB_OBJINFO where TABLE_NAME = #{TABLE_NAME} and COL_NAME =
		#{COL_NAME}

	</delete>

	<!-- 객체정보관리 기준일자 체크 작성자 조형욱 -->
	<select id="getAdminObjectInfoCheckDate" parameterType="String"
		resultType="map">

		select
		COL_NAME,STAND_DATE
		from
		TB_OBJINFO
		WHERE TABLE_NAME =
		#{TABLE_NAME}

	</select>


	<!-- 객체 관계 관리 리스트(기준 테이블) 작성자 조형욱 -->
	<select id="getAdminObjectRelStand" resultType="map">
		select
		TABLE_NAME,
		OBJ_NAME
		from TB_OBJECT

	</select>


	<!-- 객체 관계 관리 리스트(연결 테이블) 작성자 조형욱 -->
	<select id="getAdminObjectRelConn" parameterType="String"
		resultType="map">

		select C.STAND STAND,C.TABLE_NAME TABLE_NAME,C.OBJ_NAME
		OBJ_NAME,D.CONN_TABLE
		CONN_TABLE from
		( select
		B.TABLE_NAME STAND ,
		A.TABLE_NAME TABLE_NAME,A.OBJ_NAME OBJ_NAME
		from TB_OBJECT A,

		(select
		TABLE_NAME
		from TB_OBJECT
		WHERE TABLE_NAME=
		#{TABLE_NAME}
		)B
		)C
		join
		( select
		CONN_TABLE
		from
		TB_OBJ_REL
		WHERE STD_TABLE=
		#{TABLE_NAME}
		)D
		on C.TABLE_NAME
		= D.CONN_TABLE(+)



	</select>


	<!-- 객체 관계 관리 리스트(콤보) 작성자 조형욱 -->
	<select id="getAdminObjectRelCombo" parameterType="String"
		resultType="map">
		select
		TABLE_NAME id ,TABLE_NAME name
		from TB_OBJECT
		where
		table_name != #{TABLE_NAME}

		minus

		select
		CONN_TABLE id ,CONN_TABLE name
		from tb_obj_rel
		where std_table = #{TABLE_NAME}

	</select>


	<!-- 객체 관계 관리 조인식 설정 작성자 조형욱 -->
	<select id="getAdminObjectRelJoin" parameterType="String"
		resultType="map">
		select STD_TABLE,CONN_TABLE,JOIN_EXPR
		from TB_OBJ_REL
		where
		STD_TABLE = #{STD_TABLE} and
		CONN_TABLE = #{CONN_TABLE}



	</select>


	<!-- 객체 관계 관리 조인식 자동 작성 작성자 조형욱 -->
	<select id="getAdminObjectRelJoinStandKeyList" parameterType="String"
		resultType="map">
		select TABLE_NAME,COL_NAME
		from TB_OBJINFO
		WHERE PK_GUBUN
		='Y'
		and TABLE_NAME = #{STD_TABLE}
	</select>


	<select id="getAdminObjectRelJoinConnKeyList" parameterType="String"
		resultType="map">
		select TABLE_NAME,COL_NAME
		from TB_OBJINFO
		WHERE PK_GUBUN
		='Y'
		and TABLE_NAME = #{CONN_TABLE}
	</select>


	<!-- 객체 관계 관리 업데이트 작성자 조형욱 -->
	<update id="setAdminObjectRelJoinUpdate" parameterType="map">

		update
		TB_OBJ_REL

		set JOIN_EXPR = #{JOIN_EXPR},

		UPDATE_ID = #{ID},

		update_dt =
		to_char(SYSDATE,'yyyymmdd'),

		update_tm =
		to_char(SYSDATE,'hh24miss')

		where STD_TABLE = #{STD_TABLE}
		and
		CONN_TABLE = #{CONN_TABLE}

	</update>


	<!-- 객체 관계 관리 insert 작성자 조형욱 -->
	<insert id="setAdminObjectRelJoinInsert" parameterType="map">
		INSERT
		INTO
		TB_OBJ_REL(STD_TABLE,CONN_TABLE,JOIN_EXPR,CREATE_ID,UPDATE_ID,UPDATE_DT,UPDATE_TM)
		VALUES
		(#{STD_TABLE},#{CONN_TABLE},#{JOIN_EXPR},#{ID},#{ID},to_char(SYSDATE,'yyyymmdd'),to_char(SYSDATE,'hh24miss'))
	</insert>


	<!-- 객체 관계 관리 삭제 작성자 조형욱 -->
	<delete id="setAdminObjectRelJoinDelete" parameterType="String">

		delete
		from
		TB_OBJ_REL
		where STD_TABLE = #{STD_TABLE}
		and
		CONN_TABLE =
		#{CONN_TABLE}

	</delete>

	<!-- 객체 정보 관리 인서트 업데이트 구분 작성자 조형욱 -->
	<select id="getAdminObjectInfoGubunInsertUpdate" parameterType="String"
		resultType="map">
		select
		a.table_name table_name,a.col_name col_name

		from
		TB_OBJINFO A
		WHERE a.table_name =#{TABLE_NAME}
		and a.col_name
		=#{COL_NAME}

	</select>

	<!-- 객체 정보 활성화 채크 작성자 조형욱 -->
	<select id="getAdminObjectActiveCheck3" parameterType="String"
		resultType="map">
		SELECT COL_NAME FROM TB_OBJINFO
		WHERE TABLE_NAME =
		#{table_name}
		AND STAND_DATE ='Y'
	</select>

	<!-- 관리자 가입 아이디 검색으로 아이디 중복(일반 회원 TB 포함) 조회 -->
	<select id="getManagerIdCheck" parameterType="String"
		resultType="map">
		SELECT A.USER_ID
		FROM (select USER_ID FROM TB_OLAP_USR WHERE
		USER_ID=#{insertId}
		union all
		select MANAGER_ID AS USER_ID FROM
		TB_OLAP_MANAGER WHERE
		MANAGER_ID=#{insertId}
		) A
	</select>


	<!-- 관리자 가입 데이터 인서트 -->
	<insert id="setSignUpManager" parameterType="map">
		INSERT ALL
		INTO
		TB_OLAP_MANAGER
		(MANAGER_ID,MANAGER_PW,CREATE_ID,UPDATE_ID,UPDATE_DT,UPDATE_TM)
		VALUES(#{MANAGER_ID},#{MANAGER_PASSWORD},#{ID},#{ID},to_char(SYSDATE,'yyyymmdd'),to_char(SYSDATE,'hh24miss'))
		INTO
		TB_OLAP_MANAGER_IP(MANAGER_ID,MANAGER_IP,CREATE_ID,UPDATE_ID,UPDATE_DT,UPDATE_TM)
		VALUES(#{MANAGER_ID},#{MANAGER_IP},#{ID},#{ID},to_char(SYSDATE,'yyyymmdd'),to_char(SYSDATE,'hh24miss'))
		SELECT * FROM DUAL
	</insert>

	<!-- 관리자 리스트 가져오기 작성자 조형욱 -->
	<select id="getManagerList" resultType="map">
		select
		MANAGER_ID,ENABLED
		from TB_OLAP_MANAGER

	</select>

	<!-- 관리자 삭제 작성자 조형욱 -->
	<delete id="setManagerDelete" parameterType="String">
		<![CDATA[
			delete from TB_OLAP_MANAGER
			where  MANAGER_ID = #{MANAGER_ID}
		]]>
	</delete>

	<!-- 관리자 ip 가져오기 작성자 조형욱 -->
	<select id="getManagerIpList" resultType="map">
		select
		MANAGER_ID,
		MANAGER_IP,
		MANAGER_IP as STAND_MANAGER_IP
		from TB_OLAP_MANAGER_IP
		where
		MANAGER_ID = #{MANAGER_ID}

	</select>

	<!-- IP] insert 작성자 조형욱 -->
	<insert id="setManagerIpInsert">
		INSERT INTO
		TB_OLAP_MANAGER_IP(MANAGER_ID,MANAGER_IP,CREATE_ID,UPDATE_ID,UPDATE_DT,UPDATE_TM)
		VALUES
		(#{MANAGER_ID},#{MANAGER_IP},#{ID},#{ID},to_char(SYSDATE,'yyyymmdd'),to_char(SYSDATE,'hh24miss'))
	</insert>

	<!-- 아이피 삭제 작성자 조형욱 -->
	<delete id="setManagerIpDelete" parameterType="map">

		delete from
		TB_OLAP_MANAGER_IP
		where MANAGER_ID = #{MANAGER_ID}
		and MANAGER_IP =
		#{MANAGER_IP}

	</delete>

	<!-- 아이피 업데이트 작성자 조형욱 -->
	<update id="setManagerIpUpdate" parameterType="map">

		update
		TB_OLAP_MANAGER_IP

		set MANAGER_IP = #{MANAGER_IP},

		UPDATE_ID = #{ID},

		update_dt =
		to_char(SYSDATE,'yyyymmdd'),

		update_tm =
		to_char(SYSDATE,'hh24miss')

		where MANAGER_ID = #{MANAGER_ID}
		and
		MANAGER_IP = #{STAND_MANAGER_IP}

	</update>

	<!-- 관리자 비번 가져오기 작성자 조형욱 -->
	<select id="getAdminPwd" resultType="map">
		select
		MANAGER_PW

		from
		TB_OLAP_MANAGER
		where MANAGER_ID = #{managerId}

	</select>

	<!-- 관리자 비밀번호 변경 작성자 조형욱 -->
	<update id="ActionAdminPwdChange" parameterType="map">
		UPDATE
		TB_OLAP_MANAGER
		SET MANAGER_PW = #{encodePwd}
		,UPDATE_ID = #{MANAGER_ID}
		,UPDATE_DT = to_char(SYSDATE,'yyyymmdd')
		,UPDATE_TM =
		to_char(SYSDATE,'hh24miss')
		WHERE MANAGER_ID= #{MANAGER_ID}
	</update>

	<!-- 관리자 활성화 업데이트 작성자 조형욱 -->
	<update id="setManagerEnabledUpdate" parameterType="map">

		update
		TB_OLAP_MANAGER

		set ENABLED = #{ENABLED},

		UPDATE_ID = #{UPDATE_ID},

		update_dt =
		to_char(SYSDATE,'yyyymmdd'),

		update_tm =
		to_char(SYSDATE,'hh24miss')

		where MANAGER_ID = #{MANAGER_ID}


	</update>

	<!-- 회원저장목록(관리자) 삭제 작성자 조형욱 -->
	<delete id="setManagerSaveDelete" parameterType="String">
		<![CDATA[
			delete from TB_USR_SAVE_LIST
		    WHERE USER_ID = #{MANAGER_ID}
		]]>
	</delete>
</mapper>